<?xml version="1.0"?>
<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum" vellum:ignore="richText">
  <h:head>
    <h:title>Settle Invoices</h:title>
    <model>
      <instance>
        <data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/B93CA6C8-3636-4A97-A688-EDBC6AA54DC1" uiVersion="1" version="1439" name="Settle Invoices">
          <total-amount-owed-to-teuk-saat/>
          <total-amount-owed-to-entrepreneur/>
          <outstanding-balance/>
          <invoice ids="" count="" current_index="">
            <item id="" index="" jr:template="">
              <invoice-display-string/>
              <amount-owed-to-teuk-saat/>
              <amount-owed-to-entrepreneur/>
              <close-invoice>
                <invoice>
                  <case xmlns="http://commcarehq.org/case/transaction/v2" case_id="" date_modified="" user_id="">
                    <close/>
                  </case>
                </invoice>
                <amount-owed-to-teuk-saat/>
                <amount-owed-to-entrepreneur/>
              </close-invoice>
            </item>
          </invoice>
          <number-of-invoices/>
          <invoice_ids/>
          <balance-summary>
            <initial_summary/>
            <invoices jr:template="">
              <invoice-label/>
              <invoice_id/>
            </invoices>
          </balance-summary>
          <teuk-saat-pays-entrepreneur/>
          <entrepreneur-owes-teuk-saat>
            <pay-in-full/>
            <amount-to-pay/>
            <total-to-pay/>
            <invoice-total-to-pay/>
            <question2>
              <question3/>
              <invoices_to_pay/>
              <question1/>
            </question2>
            <remaining-funds/>
            <invoice-to-partially-pay/>
            <partially-settle-invoice>
              <update-invoice-case>
                <case xmlns="http://commcarehq.org/case/transaction/v2" case_id="" date_modified="" user_id="">
                  <update>
                    <amount-owed-to-teuk-saat/>
                  </update>
                </case>
              </update-invoice-case>
              <invoice-case-id/>
              <new-amount-owed-to-teuk-saat/>
              <old-amount-owed-to-teuk-saat/>
              <partial-payment-confirmation/>
            </partially-settle-invoice>
          </entrepreneur-owes-teuk-saat>
          <transaction-summary>
            <paid-by-entrepreneur/>
            <total-settled/>
            <total-unsettled/>
            <paid/>
            <invoices jr:template="">
              <invoice-label/>
              <invoice_id/>
              <payment-status/>
            </invoices>
            <question4/>
          </transaction-summary>
          <case xmlns="http://commcarehq.org/case/transaction/v2" case_id="" date_modified="" user_id=""/>
          <orx:meta xmlns:cc="http://commcarehq.org/xforms">
            <orx:deviceID/>
            <orx:timeStart/>
            <orx:timeEnd/>
            <orx:username/>
            <orx:userID/>
            <orx:instanceID/>
            <cc:appVersion/>
          </orx:meta>
        </data>
      </instance>
      <instance src="jr://instance/casedb" id="casedb"/>
      <instance src="jr://instance/session" id="commcaresession"/>
      <bind nodeset="/data/total-amount-owed-to-teuk-saat" calculate="sum(/data/invoice/item/amount-owed-to-teuk-saat)"/>
      <bind nodeset="/data/total-amount-owed-to-entrepreneur" calculate="sum(/data/invoice/item/amount-owed-to-entrepreneur)"/>
      <bind nodeset="/data/outstanding-balance" calculate="/data/total-amount-owed-to-teuk-saat - /data/total-amount-owed-to-entrepreneur"/>
      <bind nodeset="/data/invoice/@current_index" calculate="count(/data/invoice/item)"/>
      <bind nodeset="/data/invoice/item"/>
      <bind nodeset="/data/invoice/item/invoice-display-string" calculate="concat(instance('casedb')/casedb/case[@case_id = current()/../@id]/month, '/', instance('casedb')/casedb/case[@case_id = current()/../@id]/year, ' ', instance('casedb')/casedb/case[@case_id = current()/../@id]/case_name, ': ', coalesce(instance('casedb')/casedb/case[@case_id = current()/../@id]/amount-owed-to-teuk-saat, concat('-', instance('casedb')/casedb/case[@case_id = current()/../@id]/amount-owed-to-entrepreneur)))"/>
      <bind nodeset="/data/invoice/item/amount-owed-to-teuk-saat" calculate="coalesce(instance('casedb')/casedb/case[@case_id = current()/../@id]/amount-owed-to-teuk-saat, 0)"/>
      <bind nodeset="/data/invoice/item/amount-owed-to-entrepreneur" calculate="coalesce(instance('casedb')/casedb/case[@case_id = current()/../@id]/amount-owed-to-entrepreneur, 0)"/>
      <bind nodeset="/data/invoice/item/close-invoice" relevant="selected(/data/entrepreneur-owes-teuk-saat/question2/invoices_to_pay, current()/../@id) or /data/invoice/item/amount-owed-to-entrepreneur &gt; 0 or /data/entrepreneur-owes-teuk-saat/pay-in-full = 'yes'"/>
      <bind nodeset="/data/invoice/item/close-invoice/invoice/case/close"/>
      <bind nodeset="/data/invoice/item/close-invoice/invoice/case/@date_modified" calculate="/data/meta/timeEnd" type="xsd:dateTime"/>
      <bind nodeset="/data/invoice/item/close-invoice/invoice/case/@user_id" calculate="/data/meta/userID"/>
      <bind nodeset="/data/invoice/item/close-invoice/invoice/case/@case_id" calculate="/data/invoice/item/@id"/>
      <bind nodeset="/data/invoice/item/close-invoice/amount-owed-to-teuk-saat" calculate="/data/invoice/item/amount-owed-to-teuk-saat"/>
      <bind nodeset="/data/invoice/item/close-invoice/amount-owed-to-entrepreneur" calculate="/data/invoice/item/amount-owed-to-entrepreneur"/>
      <bind nodeset="/data/number-of-invoices" calculate="count(/data/invoice/item)"/>
      <bind nodeset="/data/invoice_ids" calculate="join(' ', /data/invoice/item/@id)"/>
      <bind nodeset="/data/balance-summary"/>
      <bind nodeset="/data/balance-summary/initial_summary"/>
      <bind nodeset="/data/balance-summary/invoices"/>
      <bind nodeset="/data/balance-summary/invoices/invoice-label"/>
      <bind nodeset="/data/balance-summary/invoices/invoice_id" calculate="selected-at(/data/invoice_ids, position(..))"/>
      <bind nodeset="/data/teuk-saat-pays-entrepreneur" constraint=". = 'confirm'" jr:constraintMsg="jr:itext('teuk-saat-pays-entrepreneur-constraintMsg')" relevant="/data/total-amount-owed-to-entrepreneur &gt;= /data/total-amount-owed-to-teuk-saat"/>
      <bind nodeset="/data/entrepreneur-owes-teuk-saat" relevant="/data/total-amount-owed-to-entrepreneur &lt; /data/total-amount-owed-to-teuk-saat"/>
      <bind nodeset="/data/entrepreneur-owes-teuk-saat/pay-in-full"/>
      <bind nodeset="/data/entrepreneur-owes-teuk-saat/amount-to-pay" type="xsd:int" constraint=". &lt; /data/outstanding-balance" jr:constraintMsg="jr:itext('entrepreneur-owes-teuk-saat/amount-to-pay-constraintMsg')" relevant="/data/entrepreneur-owes-teuk-saat/pay-in-full = 'no'"/>
      <bind nodeset="/data/entrepreneur-owes-teuk-saat/total-to-pay" calculate="/data/entrepreneur-owes-teuk-saat/amount-to-pay + /data/total-amount-owed-to-entrepreneur"/>
      <bind nodeset="/data/entrepreneur-owes-teuk-saat/invoice-total-to-pay" calculate="sum(/data/invoice/item/close-invoice/amount-owed-to-teuk-saat)"/>
      <bind nodeset="/data/entrepreneur-owes-teuk-saat/question2" relevant="/data/entrepreneur-owes-teuk-saat/pay-in-full = 'no'"/>
      <bind nodeset="/data/entrepreneur-owes-teuk-saat/question2/question3"/>
      <bind nodeset="/data/entrepreneur-owes-teuk-saat/question2/invoices_to_pay" jr:constraintMsg="jr:itext('entrepreneur-owes-teuk-saat/question2/invoices_to_pay-constraintMsg')"/>
      <bind nodeset="/data/entrepreneur-owes-teuk-saat/question2/question1" constraint="false()" jr:constraintMsg="jr:itext('entrepreneur-owes-teuk-saat/question2/question1-constraintMsg')" relevant="/data/entrepreneur-owes-teuk-saat/invoice-total-to-pay &gt; /data/entrepreneur-owes-teuk-saat/total-to-pay"/>
      <bind nodeset="/data/entrepreneur-owes-teuk-saat/remaining-funds" relevant="/data/entrepreneur-owes-teuk-saat/pay-in-full = 'no'" calculate="/data/entrepreneur-owes-teuk-saat/total-to-pay - /data/entrepreneur-owes-teuk-saat/invoice-total-to-pay"/>
      <bind nodeset="/data/entrepreneur-owes-teuk-saat/invoice-to-partially-pay" constraint="/data/entrepreneur-owes-teuk-saat/partially-settle-invoice/old-amount-owed-to-teuk-saat &gt; /data/entrepreneur-owes-teuk-saat/remaining-funds" jr:constraintMsg="jr:itext('entrepreneur-owes-teuk-saat/invoice-to-partially-pay-constraintMsg')" relevant="/data/entrepreneur-owes-teuk-saat/pay-in-full = 'no'"/>
      <bind nodeset="/data/entrepreneur-owes-teuk-saat/partially-settle-invoice" relevant="coalesce(/data/entrepreneur-owes-teuk-saat/invoice-to-partially-pay, -1) != -1"/>
      <bind nodeset="/data/entrepreneur-owes-teuk-saat/partially-settle-invoice/update-invoice-case/case/update/amount-owed-to-teuk-saat" calculate="/data/entrepreneur-owes-teuk-saat/partially-settle-invoice/new-amount-owed-to-teuk-saat"/>
      <bind nodeset="/data/entrepreneur-owes-teuk-saat/partially-settle-invoice/update-invoice-case/case/@date_modified" calculate="/data/meta/timeEnd" type="xsd:dateTime"/>
      <bind nodeset="/data/entrepreneur-owes-teuk-saat/partially-settle-invoice/update-invoice-case/case/@user_id" calculate="/data/meta/userID"/>
      <bind nodeset="/data/entrepreneur-owes-teuk-saat/partially-settle-invoice/update-invoice-case/case/@case_id" calculate="/data/entrepreneur-owes-teuk-saat/invoice-to-partially-pay"/>
      <bind nodeset="/data/entrepreneur-owes-teuk-saat/partially-settle-invoice/invoice-case-id" calculate="/data/entrepreneur-owes-teuk-saat/invoice-to-partially-pay"/>
      <bind nodeset="/data/entrepreneur-owes-teuk-saat/partially-settle-invoice/new-amount-owed-to-teuk-saat" calculate="/data/entrepreneur-owes-teuk-saat/partially-settle-invoice/old-amount-owed-to-teuk-saat - /data/entrepreneur-owes-teuk-saat/remaining-funds"/>
      <bind nodeset="/data/entrepreneur-owes-teuk-saat/partially-settle-invoice/old-amount-owed-to-teuk-saat" calculate="instance('casedb')/casedb/case[@case_id = /data/entrepreneur-owes-teuk-saat/partially-settle-invoice/invoice-case-id]/amount-owed-to-teuk-saat"/>
      <bind nodeset="/data/entrepreneur-owes-teuk-saat/partially-settle-invoice/partial-payment-confirmation"/>
      <bind nodeset="/data/transaction-summary"/>
      <bind nodeset="/data/transaction-summary/paid-by-entrepreneur" calculate="if(/data/entrepreneur-owes-teuk-saat/pay-in-full = 'yes', /data/outstanding-balance, coalesce(/data/entrepreneur-owes-teuk-saat/amount-to-pay, 0))"/>
      <bind nodeset="/data/transaction-summary/total-settled" calculate="/data/transaction-summary/paid-by-entrepreneur + /data/total-amount-owed-to-entrepreneur"/>
      <bind nodeset="/data/transaction-summary/total-unsettled" calculate="/data/total-amount-owed-to-teuk-saat - /data/transaction-summary/total-settled"/>
      <bind nodeset="/data/transaction-summary/paid"/>
      <bind nodeset="/data/transaction-summary/invoices"/>
      <bind nodeset="/data/transaction-summary/invoices/invoice-label"/>
      <bind nodeset="/data/transaction-summary/invoices/invoice_id" calculate="selected-at(/data/invoice_ids, position(..))"/>
      <bind nodeset="/data/transaction-summary/invoices/payment-status" calculate="if((/data/entrepreneur-owes-teuk-saat/pay-in-full = 'yes' or selected(/data/entrepreneur-owes-teuk-saat/question2/invoices_to_pay, /data/transaction-summary/invoices/invoice_id)), 'paid', if(/data/entrepreneur-owes-teuk-saat/invoice-to-partially-pay = /data/transaction-summary/invoices/invoice_id, 'partially paid', 'unpaid'))"/>
      <bind nodeset="/data/transaction-summary/question4"/>
      <setvalue event="xforms-ready" ref="/data/invoice/@ids" value="join(' ', instance('casedb')/casedb/case[index/parent = instance('commcaresession')/session/data/case_id][@case_type = 'invoice'][@status = 'open']/@case_id)"/>
      <setvalue event="xforms-ready" ref="/data/invoice/@count" value="count-selected(/data/invoice/@ids)"/>
      <setvalue event="jr-insert" ref="/data/invoice/item/@index" value="int(/data/invoice/@current_index)"/>
      <setvalue event="jr-insert" ref="/data/invoice/item/@id" value="selected-at(/data/invoice/@ids, ../@index)"/>
      <itext>
        <translation lang="en" default="">
          <text id="invoice/item/close-invoice-label">
            <value>close-invoice</value>
          </text>
          <text id="balance-summary-label">
            <value>Balance Summary</value>
          </text>
          <text id="balance-summary/initial_summary-label">
            <value>Total amount owed to entrepreneur: <output value="/data/total-amount-owed-to-entrepreneur"/>
              Total amount owed to teuk-saat: <output value="/data/total-amount-owed-to-teuk-saat"/></value>
          </text>
          <text id="balance-summary/invoices-label">
            <value>Invoices</value>
          </text>
          <text id="balance-summary/invoices/invoice-label-label">
            <value>
              <output value="/data/invoice/item[@id = current()/../invoice_id]/invoice-display-string"/>
            </value>
          </text>
          <text id="teuk-saat-pays-entrepreneur-label">
            <value>Teuk Saat owes <output value="abs(/data/outstanding-balance)"/> to the entrepreneur

              Confirm that this amount has been paid.</value>
          </text>
          <text id="teuk-saat-pays-entrepreneur-constraintMsg">
            <value>You must pay the entrepreneur</value>
          </text>
          <text id="teuk-saat-pays-entrepreneur-confirm-label">
            <value>confirm</value>
          </text>
          <text id="entrepreneur-owes-teuk-saat-label">
            <value>Entrepreneur Owes Teuk Saat</value>
          </text>
          <text id="entrepreneur-owes-teuk-saat/pay-in-full-label">
            <value>The outstanding balance is <output value="/data/outstanding-balance"/>
              Would you like to pay in full?</value>
          </text>
          <text id="entrepreneur-owes-teuk-saat/pay-in-full-yes-label">
            <value>yes</value>
          </text>
          <text id="entrepreneur-owes-teuk-saat/pay-in-full-no-label">
            <value>no</value>
          </text>
          <text id="entrepreneur-owes-teuk-saat/amount-to-pay-label">
            <value>Total amount owed to entrepreneur: <output value="/data/total-amount-owed-to-entrepreneur"/>
              Total amount owed to teuk-saat: <output value="/data/total-amount-owed-to-teuk-saat"/>

              The entrepreneur has an outstanding balance of <output value="/data/outstanding-balance"/>.

              How much are they willing to pay?</value>
          </text>
          <text id="entrepreneur-owes-teuk-saat/amount-to-pay-constraintMsg">
            <value>That amount is more than the amount owed.  They should pay in full.</value>
          </text>
          <text id="entrepreneur-owes-teuk-saat/question2/question3-label">
            <value>Total owed:  <output value="/data/total-amount-owed-to-teuk-saat"/>

              Total to pay (including school program money): <output value="/data/entrepreneur-owes-teuk-saat/total-to-pay"/>

              Total of selected invoices: <output value="/data/entrepreneur-owes-teuk-saat/invoice-total-to-pay"/></value>
          </text>
          <text id="entrepreneur-owes-teuk-saat/question2/invoices_to_pay-label">
            <value>Please select which invoices you'd like to settle in full</value>
          </text>
          <text id="entrepreneur-owes-teuk-saat/question2/question1-label">
            <value>The sum of the selected invoices exceeds the available funds</value>
          </text>
          <text id="entrepreneur-owes-teuk-saat/question2/question1-constraintMsg">
            <value>Correct the invoices before proceeding</value>
          </text>
          <text id="entrepreneur-owes-teuk-saat/invoice-to-partially-pay-label">
            <value>Select an invoice to apply the remaining </value>
          </text>
          <text id="entrepreneur-owes-teuk-saat/invoice-to-partially-pay-constraintMsg">
            <value>This invoice can be settled in full!</value>
          </text>
          <text id="entrepreneur-owes-teuk-saat/partially-settle-invoice-label">
            <value>partially-settle-invoice</value>
          </text>
          <text id="entrepreneur-owes-teuk-saat/partially-settle-invoice/partial-payment-confirmation-label">
            <value>The amount of <output value="/data/entrepreneur-owes-teuk-saat/remaining-funds"/> has been credited to that invoice.  The remaining balance on that invoice is <output value="/data/entrepreneur-owes-teuk-saat/partially-settle-invoice/new-amount-owed-to-teuk-saat"/>.</value>
          </text>
          <text id="transaction-summary-label">
            <value>Transaction Summary</value>
          </text>
          <text id="transaction-summary/paid-label">
            <value>Paid by entrepreneur: <output value="/data/transaction-summary/paid-by-entrepreneur"/>

              School Program: <output value="/data/total-amount-owed-to-entrepreneur"/>

              Details of payment:</value>
          </text>
          <text id="transaction-summary/invoices/invoice-label-label">
            <value><output value="/data/invoice/item[@id = current()/../invoice_id]/invoice-display-string"/> - <output value="/data/transaction-summary/invoices/payment-status"/></value>
          </text>
          <text id="transaction-summary/question4-label">
            <value>Total settled (paid by entrepreneur and school program together): <output value="/data/transaction-summary/total-settled"/>

              Remaining invoices: <output value="/data/transaction-summary/total-unsettled"/></value>
          </text>
        </translation>
        <translation lang="khm">
          <text id="invoice/item/close-invoice-label">
            <value>close-invoice</value>
          </text>
          <text id="balance-summary-label">
            <value>Balance Summary</value>
          </text>
          <text id="balance-summary/initial_summary-label">
            <value>Total amount owed to entrepreneur: <output value="/data/total-amount-owed-to-entrepreneur"/>
              Total amount owed to teuk-saat: <output value="/data/total-amount-owed-to-teuk-saat"/>
            </value>
          </text>
          <text id="balance-summary/invoices-label">
            <value>Invoices</value>
          </text>
          <text id="balance-summary/invoices/invoice-label-label">
            <value>
              <output value="/data/invoice/item[@id = current()/../invoice_id]/invoice-display-string"/>
            </value>
          </text>
          <text id="teuk-saat-pays-entrepreneur-label">
            <value>Teuk Saat owes <output value="abs(/data/outstanding-balance)"/> to the entrepreneur</value>
          </text>
          <text id="teuk-saat-pays-entrepreneur-constraintMsg">
            <value>You must pay the entrepreneur</value>
          </text>
          <text id="teuk-saat-pays-entrepreneur-confirm-label">
            <value>confirm</value>
          </text>
          <text id="entrepreneur-owes-teuk-saat-label">
            <value>Entrepreneur Owes Teuk Saat</value>
          </text>
          <text id="entrepreneur-owes-teuk-saat/pay-in-full-label">
            <value>The outstanding balance is <output value="/data/outstanding-balance"/>
              Would you like to pay in full?</value>
          </text>
          <text id="entrepreneur-owes-teuk-saat/pay-in-full-yes-label">
            <value>yes</value>
          </text>
          <text id="entrepreneur-owes-teuk-saat/pay-in-full-no-label">
            <value>no</value>
          </text>
          <text id="entrepreneur-owes-teuk-saat/amount-to-pay-label">
            <value>Total amount owed to entrepreneur: <output value="/data/total-amount-owed-to-entrepreneur"/>
              Total amount owed to teuk-saat: <output value="/data/total-amount-owed-to-teuk-saat"/>
            </value>
          </text>
          <text id="entrepreneur-owes-teuk-saat/amount-to-pay-constraintMsg">
            <value>That amount is more than the amount owed.  They should pay in full.</value>
          </text>
          <text id="entrepreneur-owes-teuk-saat/question2/question3-label">
            <value>Total owed:  <output value="/data/total-amount-owed-to-teuk-saat"/>

              Total to pay (including school program money): <output value="/data/entrepreneur-owes-teuk-saat/total-to-pay"/>

              Total of selected invoices: <output value="/data/entrepreneur-owes-teuk-saat/invoice-total-to-pay"/></value>
          </text>
          <text id="entrepreneur-owes-teuk-saat/question2/invoices_to_pay-label">
            <value>Please select which invoices you'd like to settle in full</value>
          </text>
          <text id="entrepreneur-owes-teuk-saat/question2/question1-label">
            <value>The sum of the selected invoices exceeds the available funds</value>
          </text>
          <text id="entrepreneur-owes-teuk-saat/question2/question1-constraintMsg">
            <value>Correct the invoices before proceeding</value>
          </text>
          <text id="entrepreneur-owes-teuk-saat/invoice-to-partially-pay-label">
            <value>Select an invoice to apply the remaining </value>
          </text>
          <text id="entrepreneur-owes-teuk-saat/invoice-to-partially-pay-constraintMsg">
            <value>This invoice can be settled in full!</value>
          </text>
          <text id="entrepreneur-owes-teuk-saat/partially-settle-invoice-label">
            <value>partially-settle-invoice</value>
          </text>
          <text id="entrepreneur-owes-teuk-saat/partially-settle-invoice/partial-payment-confirmation-label">
            <value>The amount of <output value="/data/entrepreneur-owes-teuk-saat/remaining-funds"/> has been credited to that invoice.  The remaining balance on that invoice is <output value="/data/entrepreneur-owes-teuk-saat/partially-settle-invoice/new-amount-owed-to-teuk-saat"/>.</value>
          </text>
          <text id="transaction-summary-label">
            <value>Transaction Summary</value>
          </text>
          <text id="transaction-summary/paid-label">
            <value>Paid by entrepreneur: <output value="/data/transaction-summary/paid-by-entrepreneur"/>

              School Program: <output value="/data/total-amount-owed-to-entrepreneur"/>

              Details of payment:</value>
          </text>
          <text id="transaction-summary/invoices/invoice-label-label">
            <value>
              <output value="/data/invoice/item[@id = current()/../invoice_id]/invoice-display-string"/>
              <output value="/data/transaction-summary/invoices/payment-status"/>
            </value>
          </text>
          <text id="transaction-summary/question4-label">
            <value>Total settled (paid by entrepreneur and school program together): <output value="/data/transaction-summary/total-settled"/>

              Remaining invoices: <output value="/data/transaction-summary/total-unsettled"/></value>
          </text>
        </translation>
      </itext>
      <bind calculate="/data/meta/timeEnd" nodeset="/data/case/@date_modified" type="xsd:dateTime"/>
      <bind calculate="/data/meta/userID" nodeset="/data/case/@user_id"/>
      <bind calculate="instance('commcaresession')/session/data/case_id" nodeset="/data/case/@case_id"/>
      <setvalue event="xforms-ready" ref="/data/meta/deviceID" value="instance('commcaresession')/session/context/deviceid"/>
      <setvalue event="xforms-ready" ref="/data/meta/timeStart" value="now()"/>
      <bind nodeset="/data/meta/timeStart" type="xsd:dateTime"/>
      <setvalue event="xforms-revalidate" ref="/data/meta/timeEnd" value="now()"/>
      <bind nodeset="/data/meta/timeEnd" type="xsd:dateTime"/>
      <setvalue event="xforms-ready" ref="/data/meta/username" value="instance('commcaresession')/session/context/username"/>
      <setvalue event="xforms-ready" ref="/data/meta/userID" value="instance('commcaresession')/session/context/userid"/>
      <setvalue event="xforms-ready" ref="/data/meta/instanceID" value="uuid()"/>
      <setvalue event="xforms-ready" ref="/data/meta/appVersion" value="instance('commcaresession')/session/context/appversion"/>
    </model>
  </h:head>
  <h:body>
    <group>
      <repeat jr:count="/data/invoice/@count" jr:noAddRemove="true()" nodeset="/data/invoice/item">
        <group ref="/data/invoice/item/close-invoice">
          <label ref="jr:itext('invoice/item/close-invoice-label')"/>
        </group>
      </repeat>
    </group>
    <group ref="/data/balance-summary" appearance="field-list">
      <label ref="jr:itext('balance-summary-label')"/>
      <trigger ref="/data/balance-summary/initial_summary" appearance="minimal">
        <label ref="jr:itext('balance-summary/initial_summary-label')"/>
      </trigger>
      <group>
        <label ref="jr:itext('balance-summary/invoices-label')"/>
        <repeat jr:count="/data/number-of-invoices" jr:noAddRemove="true()" nodeset="/data/balance-summary/invoices">
          <trigger ref="/data/balance-summary/invoices/invoice-label" appearance="minimal">
            <label ref="jr:itext('balance-summary/invoices/invoice-label-label')"/>
          </trigger>
        </repeat>
      </group>
    </group>
    <select1 ref="/data/teuk-saat-pays-entrepreneur">
      <label ref="jr:itext('teuk-saat-pays-entrepreneur-label')"/>
      <alert ref="jr:itext('teuk-saat-pays-entrepreneur-constraintMsg')"/>
      <item>
        <label ref="jr:itext('teuk-saat-pays-entrepreneur-confirm-label')"/>
        <value>confirm</value>
      </item>
    </select1>
    <group ref="/data/entrepreneur-owes-teuk-saat">
      <label ref="jr:itext('entrepreneur-owes-teuk-saat-label')"/>
      <select1 ref="/data/entrepreneur-owes-teuk-saat/pay-in-full">
        <label ref="jr:itext('entrepreneur-owes-teuk-saat/pay-in-full-label')"/>
        <item>
          <label ref="jr:itext('entrepreneur-owes-teuk-saat/pay-in-full-yes-label')"/>
          <value>yes</value>
        </item>
        <item>
          <label ref="jr:itext('entrepreneur-owes-teuk-saat/pay-in-full-no-label')"/>
          <value>no</value>
        </item>
      </select1>
      <input ref="/data/entrepreneur-owes-teuk-saat/amount-to-pay">
        <label ref="jr:itext('entrepreneur-owes-teuk-saat/amount-to-pay-label')"/>
        <alert ref="jr:itext('entrepreneur-owes-teuk-saat/amount-to-pay-constraintMsg')"/>
      </input>
      <group ref="/data/entrepreneur-owes-teuk-saat/question2" appearance="field-list">
        <trigger ref="/data/entrepreneur-owes-teuk-saat/question2/question3" appearance="minimal">
          <label ref="jr:itext('entrepreneur-owes-teuk-saat/question2/question3-label')"/>
        </trigger>
        <select ref="/data/entrepreneur-owes-teuk-saat/question2/invoices_to_pay">
          <label ref="jr:itext('entrepreneur-owes-teuk-saat/question2/invoices_to_pay-label')"/>
          <itemset nodeset="/data/invoice/item[amount-owed-to-teuk-saat &gt; 0]">
            <label ref="invoice-display-string"/>
            <value ref="@id"/>
          </itemset>
        </select>
        <trigger ref="/data/entrepreneur-owes-teuk-saat/question2/question1" appearance="minimal">
          <label ref="jr:itext('entrepreneur-owes-teuk-saat/question2/question1-label')"/>
          <alert ref="jr:itext('entrepreneur-owes-teuk-saat/question2/question1-constraintMsg')"/>
        </trigger>
      </group>
      <select1 ref="/data/entrepreneur-owes-teuk-saat/invoice-to-partially-pay">
        <label ref="jr:itext('entrepreneur-owes-teuk-saat/invoice-to-partially-pay-label')"/>
        <alert ref="jr:itext('entrepreneur-owes-teuk-saat/invoice-to-partially-pay-constraintMsg')"/>
        <itemset nodeset="/data/invoice/item[amount-owed-to-teuk-saat &gt; 0][not(selected(/data/entrepreneur-owes-teuk-saat/question2/invoices_to_pay, @id))]">
          <label ref="invoice-display-string"/>
          <value ref="@id"/>
        </itemset>
      </select1>
      <group ref="/data/entrepreneur-owes-teuk-saat/partially-settle-invoice">
        <label ref="jr:itext('entrepreneur-owes-teuk-saat/partially-settle-invoice-label')"/>
        <trigger ref="/data/entrepreneur-owes-teuk-saat/partially-settle-invoice/partial-payment-confirmation" appearance="minimal">
          <label ref="jr:itext('entrepreneur-owes-teuk-saat/partially-settle-invoice/partial-payment-confirmation-label')"/>
        </trigger>
      </group>
    </group>
    <group ref="/data/transaction-summary" appearance="field-list">
      <label ref="jr:itext('transaction-summary-label')"/>
      <trigger ref="/data/transaction-summary/paid" appearance="minimal">
        <label ref="jr:itext('transaction-summary/paid-label')"/>
      </trigger>
      <group>
        <label ref="jr:itext('balance-summary/invoices-label')"/>
        <repeat jr:count="/data/number-of-invoices" jr:noAddRemove="true()" nodeset="/data/transaction-summary/invoices">
          <trigger ref="/data/transaction-summary/invoices/invoice-label" appearance="minimal">
            <label ref="jr:itext('transaction-summary/invoices/invoice-label-label')"/>
          </trigger>
        </repeat>
      </group>
      <trigger ref="/data/transaction-summary/question4" appearance="minimal">
        <label ref="jr:itext('transaction-summary/question4-label')"/>
      </trigger>
    </group>
  </h:body>
</h:html>
